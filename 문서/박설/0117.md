## 0117



**쿠렌토 미디어 서버 설치**

**1.시스템에 쿠렌토 저장소 추가하기
**



```
sudo apt-key adv --keyserver keyserver.ubuntu.com:80 --recv-keys 5AFA7A83
```

\#**디버깅**:공식 문서에는 다음과 같이 ' sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 5AFA7A83'

 패키지 인증 키를 추가한다. 포트 문제로 오류가 발생할 경우 위와 같이 ' ~ com:80 ~'  80번 포트를 통해 패키지 인증 키를 추가하면 됩니다.



```
sudo tee "/etc/apt/sources.list.d/kurento.list" >/dev/null <<EOF
# Kurento Media Server - Release packages
deb [arch=amd64] http://ubuntu.openvidu.io/6.9.0 $DISTRO kms6
EOF
```



**2.쿠렌토 설치하기**



```
sudo apt-get update
sudo apt-get install kurento-media-server
```

**
**

**3.쿠렌토 시작&종료**

**
**

```
sudo service kurento-media-server start
sudo service kurento-media-server stop
```

**
**

**4.TURN 서버 구성하기**

**
**

 쿠렌토 서버를 설치하면 /etc/kurento/modules/kurento/WebRtcEndpoint.conf.ini 파일이 생성됩니다. 이를 수정해서 TURN 서버

구성이 가능합니다. 



 WebRtcEndpoint.conf.ini에서 다음 줄에 주석을 지우세요.

```
turnURL=<user>:<password>@<serverIp>:<serverPort>
```

**
**

 주석을 지운 뒤 본인의 서버에 맞게 설정을 변경하세요. ex) turnURL=user:password@66.228.45.110:3478

**
**

**5.설치 확인**



@쿠렌토 서버 실행 확인

```
ps -ef | grep kurento-media-server

> nobody  1270  1  0 08:52 ?  00:01:00  /usr/bin/kurento-media-server
```



@쿠렌토 서버가 할당된 포트가 패킷 수신하는지 확인

```
sudo netstat -tupan | grep kurento

> tcp6  0  0 :::8888  :::*  LISTEN  1270/kurento-media-server
```





**일대 다 방송 ( javacript를 통한 웹앱 클라이언트 )**

**
**

**1. Node.js, Bower 설치**



```
curl -sL https://deb.nodesource.com/setup_10.x | sudo bash -    #10버전은 설치해봤으나 쿠렌토 클라이언트 빌드 과정에서 에러발생합니다.
sudo apt-get install -y nodejs
sudo npm install -g bower
```



**2. 쿠렌토-Nodejs 클라이언트 설치(install)및 시작(start)**



**(디버깅 전, 공홈 문서)**

```
git clone https://github.com/Kurento/kurento-tutorial-node.git
cd kurento-tutorial-node/kurento-one2many-callgit checkout 6.9.0
npm installnpm start
```

\#npm install 명령을 실행하면 설치중 

![img](https://t1.daumcdn.net/cfile/tistory/9948A8435C727F0A0F)

위와 같은 상태에서 멈춰버립니다. 아래 (디버깅 후)에 쓰인대로 yarn install을 통해 설치를 진행해주세요! 

**(디버깅 후)**

```
git clone https://github.com/Kurento/kurento-tutorial-node.git
cd kurento-tutorial-node/kurento-one2many-call
git checkout 6.9.0
sudo npm install -g yarnsudo apt-get install build-essentialyarn install     #root 계정이 아닌 다른 계정 사용하여 이 명령을 실행 할 것. chmod 명령어를 통해 해당 디렉토리에 대한 권한을 사용자에게 줄것.npm start
```



**3. Coturn (TURN/STUN server) 설치 및 구성** 



**@설치**

sudo apt-get install coturn



**@설정파일 변경**



/etc/kurento/modules/kurento/WebRtcEndpoint.conf.ini 



위 파일의 아래 부분(turn server 구성부분)을 본인의 서버에 맞게 변경합니다. 



```
turnURL=<user>:<password>@<serverIp>:<serverPort>
turnURL=kurento:kurentopw@<serverIp>:3478
```



@coturn 서버를 시작하고, 미디어 서버를 재시작합니다.

```
sudo service coturn start
sudo service kurento-media-server restart
```

**
**



**
**

**4. 브라우저를 통한 접속**



https://접속서버ip:8443



->크롬, firefox에 입력하면 1대 다 방송을 진행할 수 있습니다.





\#브라우저를 통해 접속하게 되면 아래 화면이 나옵니다.

presenter를 통해 방송진행자를 선택할 수 있고, viewer를 통해 시청자를 선택할 수 있습니다.

![img](https://t1.daumcdn.net/cfile/tistory/996927495C78B80B2C)



![img](https://t1.daumcdn.net/cfile/tistory/9924A43C5C78B80B29)