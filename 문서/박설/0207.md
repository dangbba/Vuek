## 0207

[네트워크 #7] IP란? ICMP란? IGMP란? ARP란? 

TCP/IP 프로토콜 계층에서 

**네트워크 계층**에서 

주로 쓰이는 프로토콜 IP,ARP,ICMP,IGMP...에 대해서 알아보도록 하자 



**IP (Internet Protocol)**

네트워크상에서 컴퓨터는 다른 컴퓨터와 구별 될 수 있도록 고유번호를 가진다. 

이것은 인터넷에 접속 할 때 컴퓨터 각각에 부여 받는 주소 or 전화번호와 같다.

\- 네트워크계층에 속하는 프로토콜

\- **실제 패킷을 전달하는 역할**을 한다.



**IP헤더란?**

IP패킷의 앞부분에서 주소 등 각종 제어 정보를 담고 있는 부분! 



**TOS(Type of Service)** 

: 인터넷에 제공되는 QOS 기능을 위한 서비스 형식 필드 (요구되는 서비스 품질을 나타냄)



**Identification**

 :  데이터그램의 조각을 구분하기 위해 사용하는 필드



**TTL(Time To Live)**

 : IP 패킷 수명 



**IP Option**

 : 부가적인 서비스 식별을 위한 필드



**Protocol Identifier**

 : 어느 상위계층 프로토콜이 데이터 내에 포함되었는가를 보여줌

( ICMP -> 1, IGMP -> 2, TCP -> 6, EGP -> 8, UDP -> 17, OSPF -> 89 등 )



**Total Packet Length**

 : IP헤더 및 데이터를 포함한( IP 패킷 전체의 길이를 바이트 단위로 길이를 표시 ( 최댓값 : 216 - 1)



**IPv4의 문제점**

\- IP 주소 부족 문제

\- 취약한 인터넷 보안



**IPv6의 등장** 

\1. IP 주소 공간의 크기를 32비트에서 128비트로 증가

\2. 주소 부족 문제를 근본적으로 해결

\3. 주소 공간의 확장으로 인해 하나의 주소를 여러 계층으로 나누어 다양한 방법으로 사용 가능

\4. IPv4에는 없던 보안 기능이 추가됨. 

​    \- 인증 절차, 데이터 무결성 보호, 선택적인 메시지 발신자 확인 기능 지원

\5.  종단간 암호화 기능을 지원하기 때문에 패킷에 대한 변조를 방지

\6. 자동 주소 설정

​    \- 자동으로 로컬 IPv6 주소를 생성. 라우터가 제공하는 네트워크 프리픽스 정보와 MAC주소를 사용



**IPv6 기본헤더(Basic Header) 필드 (8개)**

| Version (4 비트)               | IPv4 이면 4, IPv6 이면 6                                     |
| ------------------------------ | ------------------------------------------------------------ |
| Priority(8 비트)               | IP 패킷 마다 서로다른 서비스 요구사항을 구분하기 위함따라서, 민감한 실시간 응용 및 긴급하지 않은 데이터 패킷 간의 차별적 구분 가능 |
| Flow Label (20 비트)           | IP를 연결지향적 프로토콜로 사용할 수 있게 함실시간 서비스 등 같이 우선권을 주기위하여 특정 트래픽 Flow에 대한 라벨링 |
| Payload length (16 비트)       | 페이로드부의 길이 (확장헤더 + 상위계층 데이터) < 216(65536) 까지 가능 |
| Next header (8 비트)           | 기본헤더 다음에 위치하는 확장 헤더의 종류를 표시IPv4의 프로토콜 번호와 같은 역할 |
| Hop limit (8 비트)             | 버젼 4일때의 TTL과 같은 역할                                 |
| Source address(128 비트)       | 발신처 주소                                                  |
| Destination address (128 비트) | 목적지 주소만일, 소스 라우팅일 경우에 다음 라우터 주소를 나타냄 |

 

**IPv4와 IPv6 차이**

| ****      | **IPv4**                                       | **IPv6**                                                   |
| --------- | ---------------------------------------------- | ---------------------------------------------------------- |
| 주소 크기 | 32bit                                          | 128bit                                                     |
| 헤더 크기 | 가변 크기 헤더 (옵션에 따라 달라짐)            | 고정 크기 헤더 (기본 헤더 40바이트로 고정)                 |
| 헤더 길이 | 4비트                                          | IPv6헤더는 고정 크기이므로, 헤더 길이 필드 불필요          |
| 표시 방법 | 8비트씩 4부분 10진수 표시ex) 203.252.53.55     | 16비트 8부분 16진수로 표시ex) 2002:0221:ABCD:...:FFFF:4002 |
| 전송 방식 | 멀티캐스트, 유니캐스트, 브로드캐스트           | 멀티캐스트, 유니캐스트, 애니캐스트                         |
| 주소 할당 | A,B,C,D 등 클래스 단위 비순차적 할당(비효율적) | 네트워크 규모 및 단말기 수에 따른 순차적 할당(효율적)      |
| 주소 갯수 | 약 43억개                                      | 약 31조개                                                  |





**IPv6 패킷 구성**

\- 기본 헤더 : 패킷의 기본적인 정보와 송수신 주소 등, 전송에 필수적인 정보로 구성 

\- 확장 헤더(Extension Header) : 추가적인 전송 기능이 필요할때 사용됨

\- 데이터 필드 : ip 상위 프로토콜에서 사용하는 부분. tcp 세그먼트나 udp 데이터그램 등이 될 수 있음





**ARP (Address Resolution Protocol - 주소 결정 프로토콜**

**IP 주소**(논리 주소) → **MAC 주소**(물리 주소, LAN카드 주소)

\- ARP는 LAN 환경에서 논리적인 주소인 IP 주소를 물리적인 주소인 MAC 주소로 변환해 주는 네트워크 계층의 프로토콜

\- 네트워크 상에서 IP주소를 물라적 네트워크 주소( MAC주소 )로 대응시키기 위해서 사용되는 프로토콜

[![img](https://cafeptthumb-phinf.pstatic.net/MjAyMDEwMTlfMjEw/MDAxNjAzMDg2MDQ4NDQ3.JGU1nMy9vCnHnNWOPx_sUcUMit8JDKdysfKKFlcPzFEg.ZKXjXCTxEmeFuN7vGo3s42WBiakowUV3CLUINv33qDgg.PNG/arp.PNG?type=w1600)](https://m.blog.naver.com/soojin_2604/221961003092#)

\- TCP/IP 3계층(네트워크계층)의 IP 주소를 2계층(데이터링크계층)의 MAC 주소로 대응 시킬때 사용하는 프로토콜

\- 인터넷에 접속한 호스트들은 인터넷 주소에 의해서 식별되지만 실질적인 통신은 물리적인 네트워크 주소를 얻어야 가능하다.

\- ARP 프로토콜은 IP Address를 이용하여 물리적인 네트워크 주소(mac 주소)를 얻는데 사용된다. 

\- ARP를 이용하여 IP Address가 중복되어 사용되는지 찾을 수 있다.





**ICMP(****Internet Control Message Protocol)**

OSI 7계층 중에서 3계층 (네트워크 계층)의 IP 프로토콜은 전송상태에 대한 관리가 이루어지지 않는 신뢰 할 수 없는 프로토콜.

이런 IP 프로토콜의 단점을 보완하기 위한 프로토콜이 **ICMP 프로토콜**이다.

▶ IP 패킷 전송 중 에러 발생 시, 에러 발생 원인을 알려주거나 네트워크 상태를 진단해주는 기능을 제공 





**-주요 ICMP Error Reporting 메시지**

**1. Destinamtion Unreachable (목적지 도달 불가 메시지)**

   **-** 해당 목적지에 도달할 수 없음을 의미

​    \- 목적지 도달 불가 사유에 따라 다양한 Code로 구성되어 있음



**2. Redirection (재지정 메시지)**

   \-  라우팅 경로가 잘못되어 새로운 경로를 이전 경유지 또는 호스트에게 알려주는 메시지



**3. Neighbor Solicitation and Advertisement (이웃 요청과 광고 메시지)**

  **-** IPv4의 ARP 역할 및 특정 호스트로의 전달 가능 여부 검사 기능을 하는 메시지 



**4. Time Exceed (시간 초과)**

  **-** 타임아웃이 발생하여 IP패킷이 폐기되었음을 알리는 메시지.

   \- 타임아웃 사유는 Code를 통해 알 수 있다.

​     Code 0 (Time To Live exceed in Transit) : ip 패킷이 최종 목적지에 도달하기 전에 TTL 값이 0이되어 해당 패킷이 폐기됨을 알리는 메시지

​     Code 1 (Fragment reassembly time exceed) : IP 패킷 재조합 과정에서 타임 아웃 발생. 해당 IP 데이터그램이 모두 폐기됨을 알리는 메시지



**5. Echo Request (에코 요청 메시지)**

   \- ping 테스트에 사용되는 메시지로 End 노드 간에 네트워크 및 호스트 상태진단을 목적으로 사용

   \- 별도의 Code는 없으며 이외의 쿼리 타입들은 거의 사용되지 않음 

   

**IGMP(****Internet Group Management Protocol)** 

\- 호스트(컴퓨터)가 멀티캐스트 그룹 구성원을 인접한 라우터로에게 알리는 프로토콜

\- IGMP는 TCP/IP 프로토콜 집합이 동적 멀티캐스팅을 수행하기 위해 사용하는 표준 프로토콜

  (멀티 캐스트 : 한 소스에서 선택된 대상 그룹의 통신을 지원하는 네트워크 전송의 유형)

[![img](https://mblogthumb-phinf.pstatic.net/MjAyMDA1MTVfMTQ3/MDAxNTg5NTE4NTkyMjk0.8Bhz33A5KKlSv78jsnTXsTN0yKiorQxfc8cg7jRhKbkg.LJNGIfx3SfRVdqeZp42JsTkdWoaPeHVkv9Jq2KfPoxEg.PNG.soojin_2604/image.png?type=w80_blur)](https://m.blog.naver.com/soojin_2604/221961003092#)

IGMP의 위치

IGMP, ICMP 등은 데이터 전송용 프로토콜이 아니고 이벤트 또는 변화를 알리는데 사용되는 프로토콜 



  **IGMP 동작**

\1. 그룹 멤버쉽 조사 (monitoring) 

   : 멤버쉽 질의 메시지를 보내서 응답을 기다림. 일정 횟수 이상 응답 없으면 라우터는 해당 호스트를 그룹에서 탈퇴 시킴 

\2. 그룹 가입 (Joining) 

   : 그룹에 가입하고자 하는 요청을 라우터에 보고

\3. 멤버쉽 연속 (member continuation)

   : 계속해서 유지하기 원하는 보고 메시지

\4. 그룹 탈퇴 (Leaving)

   : 호스트가 해당 그룹의 멀티캐스트 트래픽을 원치 않으면 leave 메시지 전송





  **IGMP 기타 기능**

 IGMP Snooping

\- 라우터와 호스트 사이에 있는 스위치가 IGMP 메시지들을 들을 수 있게 하는 기능



 IGMP Querier Election

\- 동일 LAN에 여러 멀티캐스트 라우터가 있으면, IPv4 주소 중 가장 낮은 주소를 갖는 라우터가 Querier 역할을 집중하게 함 